{% extends "lms/reader/readerBase.html" %} 
{% block title %}首页{%endblock %}
{% block content %}
<nav>
	图书分类
	<div class="search">
		<input id="content" type="text">
		<button id="search">搜书</button>
	</div>
	<hr>
	<div>
		<ul class="cates">
			{% for cate in book_cates %}
			<li id="{{cate.id}}"><button>{{cate.name}}</button></li> {% endfor %}
		</ul>
	</div>
</nav>
<div class="recommend">
	好书推荐:
	<ul class="bookList">
		<!-- 		<li><a href="#"><img src="{{STATIC_PREFIX}}img_sys/cLang.jpg" title="C语言"></a></li>
		<li><a href="#"><img src="{{STATIC_PREFIX}}img_sys/cLang.jpg" title="C语言"></a></li>
		<li><a href="#"><img src="{{STATIC_PREFIX}}img_sys/cLang.jpg" title="C语言"></a></li> -->
		{% for book in popular_books %}
		<li><a href="">{{book.name}}</a></li> {% endfor %}
	</ul>
</div>
<article class="books">
	<p style="text-align: center">搜索结果/默认新书推荐</p>
	<div class="bookRow">
		<ul class="bookList">
			<!-- <li><a href="#"><img src="{{STATIC_PREFIX}}img_sys/cLang.jpg" title="C语言"></a>
			</li>
			<li><a href="#"><img src="img/cLang.jpg" title="C语言"></a>
			</li>
			<li><a href="#"><img src="img/cLang.jpg" title="C语言"></a>
			</li> -->
		</ul>
		<div></div>
	</div>


</article>
{% endblock %} 

{% block js %}
<script type="text/javascript">
	var add_url="{% url 'rer:reader_index' %}?json_new=10";
		$.getJSON(
	    add_url,  
	    function(data){
	    	parser(data);
		});
	
	$(".cates").click(function(){
		var add_url="{% url 'rer:reader_index' %}?json_cate=1";
		$.getJSON(
		    add_url,  
		    function(data){
		    	parser(data);
		});
	});	
	
	$("#search").click(function(){
		var add_url="{% url 'rer:reader_index' %}?json_name="+$("#content").val();
		$.getJSON(
			add_url,  
		    function(data){
				parser(data);
		});
	});
	
	function parser(data) {
		var name="";
	    var pic="";
		var rating_score=""
		$(".bookRow").remove();
		$(".pager").remove();
	    $.each(data,function(i,item){
	    	if((i+1)%3==1){
	    		$(".books").append("<div class='bookRow'></div>");
	    		$(".bookRow").append("<ul class='bookList' id ='row"+Math.floor(i/3)+"'></ul>");
	    	}
	    	$.each(item,function(key,value){
	    		if(key=="fields")
    				$.each(value, function (_key,_value) {
    					if(_key=="name")
    						name=_value;
    					if(_key=="pic_location")
    						pic=_value;
    				});
	    	});
	    	$("#row"+Math.floor(i/3)).append("<li><a href=''>"+name+"</a></li>");
	    });
	    $(".books").append("<div class='pages'><ul class='pager'><li><a href='#'>上一页</a></li><li><a href='#'>下一页</a></li></ul></div>");
	}
	
	
	$(function() {
		indexLayout();
	})
	
</script>

{% endblock %}
