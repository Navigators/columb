{% extends "lms/lib/base.html" %} 
{% block title %}入库信息{% endblock %} 
{% block content %}
<div class="row section-content">
	<div class="col-md-11">
		<form class="form-horizontal" method="post" action="{% url 'lib:lib_addcopies' %}">
			{% csrf_token %}
			<div class="container-fluid">
				<div class="row">
					<div class="col-md-4">
						<div class="form-group">
							<label for="bookName" class="col-md-3 col-sm-4 control-label">书刊名称:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="bookName" id="bookName" placeholder="书刊名称" value="{{book.name}}">
							</div>
						</div>
						<div class="form-group">
							<label for="inputCode" class="col-md-3 col-sm-4 control-label">输入码:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="inputCode" id="inputCode" placeholder="输入码" value="{{book.input_code}}">
							</div>
						</div>
						<div class="form-group">
							<label for="author" class="col-md-3 col-sm-4 control-label">著者:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="author" id="author" placeholder="著者" value="{{book.author}}">
							</div>
						</div>
						<div class="form-group">
							<label for="collectionType"
								class="col-md-3 col-sm-4 control-label">馆藏类型:</label>
							<div class="col-md-9 col-sm-8">
								{% if book %}
									<input type="text" class="form-control" name="bookType" id="bookType" placeholder="馆藏类型" value="{{book.book_type.name}}">
								{% else %}
									<select name="bookType">
										{% for type in types %}
											<option value="{{type}}">{{type}}</option>
										{% endfor %}
									</select>
								{% endif %}
							</div>
						</div>
						<div class="form-group">
							<label for="classNumber" class="col-md-3 col-sm-4 control-label">分类号:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="categoryID" id="categoryID" placeholder="分类号" value="{{book.cate.code}}">
							</div>
						</div>
						<div class="form-group">
							<label for="className" class="col-md-3 col-sm-4 control-label">分类名称:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="category" id="category" placeholder="分类名称" value="{{book.cate.name}}">
							</div>
						</div>
						<div class="form-group">
							<label for="publishingUnit"
								class="col-md-3 col-sm-4 control-label">出版单位:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="publisher" id="publisher" placeholder="出版单位" value="{{book.publisher}}">
							</div>
						</div>
						<div class="form-group row">
							<label for="place" class="col-md-2 control-label form-label">出版地:</label>
							<div class="col-md-4">
								<input type="text" class="form-control" name="publishAddr" id="publishAddr" placeholder="出版地" value="{{book.publish_addr}}">
							</div>
							<label for="date" class="col-md-2 control-label form-label">出版日期:</label>
							<div class="col-md-4">
								<input type="text" class="form-control" name="publishDate" id="publishDate" placeholder="出版日期" value="{{book.publish_date}}">
							</div>
						</div>
					</div>
					<div class="col-md-4">
						<div class="form-group">
							<label for="bookPrice" class="col-md-3 col-sm-4 control-label">书刊定价:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="bookPrice" id="bookPrice" placeholder="书刊定价" value="{{book.price}}">
							</div>
						</div>
						<div class="form-group">
							<label for="keyWords" class="col-md-3 col-sm-4 control-label">主题词:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="keyWords" placeholder="主题词" disabled>
							</div>
						</div>
						<div class="form-group">
							<label for="seriesName" class="col-md-3 col-sm-4 control-label">丛编名:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="seriesName" placeholder="丛编名" disabled>
							</div>
						</div>
						<div class="form-group row">
							<label for="revison" class="col-md-2 control-label form-label">出版版次:</label>
							<div class="col-md-4">
								<input type="text" class="form-control" name="revison" placeholder="出版版次" disabled>
							</div>
							<label for="language" class="col-md-2 control-label form-label">书刊语言:</label>
							<div class="col-md-4">
								<input type="text" class="form-control" name="language" placeholder="书刊语言" disabled>
							</div>
						</div>
						<div class="form-group row">
							<label for="digital" class="col-md-2 control-label form-label">载体形态:</label>
							<div class="col-md-4">
								<input type="text" class="form-control" name="digital" placeholder="载体形态" disabled>
							</div>
							<label for="attachment" class="col-md-2 control-label form-label">书刊附件:</label>
							<div class="col-md-4">
								<input type="text" class="form-control" name="addon" placeholder="书刊附件" disabled>
							</div>
						</div>
						<div class="form-group">
							<label for="cnIssues" class="col-md-3 col-sm-4 control-label">CN刊号:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="cnIssues" placeholder="CN刊号" disabled>
							</div>
						</div>
						<div class="form-group">
							<label for="bimonthly" class="col-md-3 col-sm-4 control-label">出版周期:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="bimonthly" placeholder="出版周期" disabled>
							</div>
						</div>
						<div class="form-group">
							<label for="organizer" class="col-md-3 col-sm-4 control-label">主办单位:</label>
							<div class="col-md-9 col-sm-8">
								<input type="text" class="form-control" name="organizer" placeholder="主办单位" disabled>
							</div>
						</div>
					</div>
					<div class="col-md-3" id="img" style="border: 1px groove red; height: 400px; text-align: center; line-height: 400px;">
						{% if book %}
							<img name="image" src="{{book.pic_location}}">
						{% endif %}
						<input type="text" id="bookimage" name="bookimage" style="display:none">
					</div>
				</div>
				<hr>
				<div class="row">
					<div class="col-md-6">
						<div class="col-md-2 control-label" style="padding-top: 10px">
							<label>内容简介:</label>
						</div>
						<textarea name="contentInfo" id="summary" class="col-md-9" style="height: 150px" placeholder="内容简介">{{book.content_intro}}</textarea>
					</div>
					<div class="col-md-6">
						<div class="col-sm-1 col-md-1 control-label"
							style="padding-left: 0px">
							<label>备注:</label>
						</div>
						<textarea name="memo" class="col-md-9" style="height: 150px" placeholder="备注">{{book.memo}}</textarea>
					</div>
				</div>
				<div class="row" style="margin-top: 20px">
					<label for="checkDate"
						class="col-md-1 col-sm-1 control-label form-label">登记时间:</label>
					<div class="col-md-2 col-sm-2">
						{% if book %}
							<input type="text" class="form-control" id="regDate" value="{{book.reg_date}}" disabled>
						{% else %}
							<input type="text" class="form-control" id="regDate" value="{{date}}" disabled>
						{% endif %}					
					</div>
					<label for="operator"
						class="col-md-1 col-sm-1 control-label form-label">操作员:</label>
					<div class="col-md-2 col-sm-2">
						{% if book %}
							<input type="text" class="form-control" id="operator"  value="{{book.operator.username}}"  disabled>
						{% else %}
							<input type="text" class="form-control" id="operator"  value="{{username}}" disabled>
						{% endif %}
					</div>
				</div>
				<div class="row" style="margin-top: 20px">
					<div class="col-md-4 col-sm-4">
						注：共有<span>x</span>册书籍，已借出<span>y</span>册，还剩<span>x-y</span>册
					</div>
					<div class="col-md-4 col-md-offset-4 col-sm-4 col-sm-offset-4">
						{% if book %}
							<button name="isbn" value="{{book.isbn}}" type="submit" class="btn btn-success">查看复本</button>
						{% else %}
							<button name="isbn" value="{{isbn}}" type="submit" class="btn btn-success">保存并添加复本</button>
						{% endif %}
						<a href="addBook.html" class="btn btn-warning"
							style="margin-left: 20px">取消</a>
						<button class="btn btn-info" style="margin-left: 20px">帮助</button>
					</div>
				</div>
			</div>
		</form>
	</div>
</div>
{% endblock %}

{% block js %}
<script>
$(document).ready(function(){
    var data_url="{% url 'lib:lib_retrieve' %}?json_isbn={{isbn}}"
        $.getJSON(
        data_url,  
        function(data){
                var name="";
                var inputCode="";
                var authors="";
                var categoryID="";
                var category="";
                var publisher="";
                var publishAddr="";
                var publishDate="";
                var price="";
                $.each(data,function(key,value){
                		if(key=="bookName")
                			name=value;
                		if(key=="inputCode")
                			inputCode=value;
                		if(key=="categoryID")
                			categoryID=value;
                		if(key=="category")
                			category=value;
                		if(key=="publisher")
                			publisher=value;
                		if(key=="publishAddr")
                			publishAddr=value;
                		if(key=="publishDate")
                			publishDate=value;
                		if(key=="price")
                			price=value;
                		if(key=="author")
                			authors=value;
            			/* if(key=="author")
            				$.each(value, function (_key,_value) {
            					authors+=_value;
            				}) */
            		})
        	$("#bookName").val(name);
        	$("#inputCode").val(inputCode);
        	$("#categoryID").val(categoryID);
        	$("#category").val(category);
        	$("#publisher").val(publisher);
        	$("#publishAddr").val(publishAddr);
        	$("#publishDate").val(publishDate);
        	$("#bookPrice").val(price);
        	$("#author").val(authors);
        });
    
	 var others_url="{% url 'lib:lib_retrieve' %}?json_others={{isbn}}"
        $.getJSON(
        others_url,  
        function(others){
                var pic="";
                var summary="";
                $.each(others,function(key,value){
                		if(key=="image")
                			pic=value;
                		if(key=="summary")
                			summary=value;
            		})
        		$("#img").append("<img src='"+pic+"'>");
                $("#bookimage").val(pic);
                $("#summary").val(summary);
        }); 
});
</script>
{% endblock %}

